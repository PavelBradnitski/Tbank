!function(n){var i={};function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=n,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=6)}([function(t,e){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(l,t,e){"use strict";(function(t){function e(t){var e,n,i,o,r,s,a=Object.create(null);if(this[p]=a,t)if("string"==typeof t)for("?"===t.charAt(0)&&(t=t.slice(1)),r=0,s=(o=t.split("&")).length;r<s;r++)-1<(e=(i=o[r]).indexOf("="))?h(a,d(i.slice(0,e)),d(i.slice(e+1))):i.length&&h(a,d(i),"");else if(u(t))for(r=0,s=t.length;r<s;r++)h(a,(i=t[r])[0],i[1]);else for(n in t)h(a,n,t[n])}var n,i,u=Array.isArray,o=e.prototype,r=/[!'\(\)~]|%20|%00/g,s=/\+/g,a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},c=function(t){return a[t]},p="__URLSearchParams__:"+Math.random();function h(t,e,n){e in t?t[e].push(""+n):t[e]=u(n)?n:[""+n]}function d(t){return decodeURIComponent(t.replace(s," "))}function f(t){return encodeURIComponent(t).replace(r,c)}o.append=function(t,e){h(this[p],t,e)},o.delete=function(t){delete this[p][t]},o.get=function(t){var e=this[p];return t in e?e[t][0]:null},o.getAll=function(t){var e=this[p];return t in e?e[t].slice(0):[]},o.has=function(t){return t in this[p]},o.set=function(t,e){this[p][t]=[""+e]},o.forEach=function(n,i){var t=this[p];Object.getOwnPropertyNames(t).forEach(function(e){t[e].forEach(function(t){n.call(i,t,e,this)},this)},this)},o.toJSON=function(){return{}},o.toString=function(){var t,e,n,i,o=this[p],r=[];for(e in o)for(n=f(e),t=0,i=o[e];t<i.length;t++)r.push(n+"="+f(i[t]));return r.join("&")},e=l.exports=t.URLSearchParams||e,n=e.prototype,i=function(){try{return!!Symbol.iterator}catch(t){return!1}}(),"forEach"in n||(n.forEach=function(n,i){var t=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(e){!e.length||e in t||(t[e]=this.getAll(e)).forEach(function(t){n.call(i,t,e,this)},this)},this)}),"keys"in n||(n.keys=function(){var n=[];this.forEach(function(t,e){n.push(e)});var t={next:function(){var t=n.shift();return{done:void 0===t,value:t}}};return i&&(t[Symbol.iterator]=function(){return t}),t}),"values"in n||(n.values=function(){var e=[];this.forEach(function(t){e.push(t)});var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i&&(t[Symbol.iterator]=function(){return t}),t}),"entries"in n||(n.entries=function(){var n=[];this.forEach(function(t,e){n.push([e,t])});var t={next:function(){var t=n.shift();return{done:void 0===t,value:t}}};return i&&(t[Symbol.iterator]=function(){return t}),t}),!i||Symbol.iterator in n||(n[Symbol.iterator]=n.entries),"sort"in n||(n.sort=function(){for(var t,e,n,i=this.entries(),o=i.next(),r=o.done,s=[],a=Object.create(null);!r;)e=(n=o.value)[0],s.push(e),e in a||(a[e]=[]),a[e].push(n[1]),r=(o=i.next()).done;for(s.sort(),t=0;t<s.length;t++)this.delete(s[t]);for(t=0;t<s.length;t++)e=s[t],this.append(e,a[e].shift())})}).call(this,e(0))},function(_,R,k){(function(t,E){var A;!function(t){var e,n=t.Promise,i=n&&"resolve"in n&&"reject"in n&&"all"in n&&"race"in n&&(new n(function(t){e=t}),"function"==typeof e);R?(R.Promise=i?n:C,R.Polyfill=C):void 0===(A=function(){return i?n:C}.call(R,k,R,_))||(_.exports=A);function o(){}var r="pending",s="sealed",a="fulfilled",u="rejected";function c(t){return"[object Array]"===Object.prototype.toString.call(t)}var p,h=void 0!==E?E:setTimeout,d=[];function f(){for(var t=0;t<d.length;t++)d[t][0](d[t][1]);p=!(d=[])}function l(t,e){d.push([t,e]),p||(p=!0,h(f,0))}function m(t,e){function n(t){S(e,t)}try{t(function(t){w(e,t)},n)}catch(t){n(t)}}function v(t){var e=t.owner,n=e.state_,i=e.data_,o=t[n],r=t.then;if("function"==typeof o){n=a;try{i=o(i)}catch(t){S(r,t)}}g(r,i)||(n===a&&w(r,i),n===u&&S(r,i))}function g(e,n){var i;try{if(e===n)throw new TypeError("A promises callback cannot return that same promise.");if(n&&("function"==typeof n||"object"==typeof n)){var t=n.then;if("function"==typeof t)return t.call(n,function(t){i||(i=!0,(n!==t?w:y)(e,t))},function(t){i||(i=!0,S(e,t))}),1}}catch(t){return i||S(e,t),1}}function w(t,e){t!==e&&g(t,e)||y(t,e)}function y(t,e){t.state_===r&&(t.state_=s,t.data_=e,l(I,t))}function S(t,e){t.state_===r&&(t.state_=s,t.data_=e,l(b,t))}function T(t){var e=t.then_;t.then_=void 0;for(var n=0;n<e.length;n++)v(e[n])}function I(t){t.state_=a,T(t)}function b(t){t.state_=u,T(t)}function C(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof C==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],m(t,this)}C.prototype={constructor:C,state_:r,then_:null,data_:void 0,then:function(t,e){var n={owner:this,then:new this.constructor(o),fulfilled:t,rejected:e};return this.state_===a||this.state_===u?l(v,n):this.then_.push(n),n.then},catch:function(t){return this.then(null,t)}},C.all=function(s){if(!c(s))throw new TypeError("You must pass an array to Promise.all().");return new this(function(n,t){var i=[],o=0;for(var e,r=0;r<s.length;r++)(e=s[r])&&"function"==typeof e.then?e.then(function(e){return o++,function(t){i[e]=t,--o||n(i)}}(r),t):i[r]=e;o||n(i)})},C.race=function(o){if(!c(o))throw new TypeError("You must pass an array to Promise.race().");return new this(function(t,e){for(var n,i=0;i<o.length;i++)(n=o[i])&&"function"==typeof n.then?n.then(t,e):t(n)})},C.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this(function(t){t(e)})},C.reject=function(n){return new this(function(t,e){e(n)})}}("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this)}).call(this,k(0),k(3).setImmediate)},function(t,o,r){(function(t){var e=void 0!==t&&t||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function i(t,e){this._id=t,this._clearFn=e}o.setTimeout=function(){return new i(n.call(setTimeout,e,arguments),clearTimeout)},o.setInterval=function(){return new i(n.call(setInterval,e,arguments),clearInterval)},o.clearTimeout=o.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(e,this._id)},o.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},o.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},o._unrefActive=o.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},r(4),o.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,o.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(0))},function(t,e,n){(function(t,l){!function(n,i){"use strict";var o,r,s,a,u,c,e,p,t;function h(t){delete r[t]}function d(t){if(s)setTimeout(d,0,t);else{var e=r[t];if(e){s=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{h(t),s=!1}}}}function f(t){t.source===n&&"string"==typeof t.data&&0===t.data.indexOf(p)&&d(+t.data.slice(p.length))}n.setImmediate||(o=1,s=!(r={}),a=n.document,t=(t=Object.getPrototypeOf&&Object.getPrototypeOf(n))&&t.setTimeout?t:n,u="[object process]"==={}.toString.call(n.process)?function(t){l.nextTick(function(){d(t)})}:function(){if(n.postMessage&&!n.importScripts){var t=!0,e=n.onmessage;return n.onmessage=function(){t=!1},n.postMessage("","*"),n.onmessage=e,t}}()?(p="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",f,!1):n.attachEvent("onmessage",f),function(t){n.postMessage(p+t,"*")}):n.MessageChannel?((e=new MessageChannel).port1.onmessage=function(t){d(t.data)},function(t){e.port2.postMessage(t)}):a&&"onreadystatechange"in a.createElement("script")?(c=a.documentElement,function(t){var e=a.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,c.removeChild(e),e=null},c.appendChild(e)}):function(t){setTimeout(d,0,t)},t.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return r[o]=i,u(o),o++},t.clearImmediate=h)}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(0),n(5))},function(t,e){var n,i,o=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(t){n=r}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var u,c=[],p=!1,h=-1;function d(){p&&u&&(p=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!p){var t=a(d);p=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,p=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function l(t,e){this.fun=t,this.array=e}function m(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new l(t,e)),1!==c.length||p||a(f)},l.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,n){"use strict";n.r(e);var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var r="sessionValidateRequest",s="sessionValidateResponse",a="logoutRequest",u="logoutResponse",c="loginRequest",p="loginResponse",h="toLoginRequest",d="toLoginResponse",f="ssoAuthDataRequest",l="ssoAuthDataResponse",m=n(1),v="sessionID";function g(t){if("string"==typeof t||!t){var e=t&&"?"===t[0]?t.substr(1):t;return new m(e)}var n=new m;for(var i in t)t.hasOwnProperty(i)&&n.append(i,t[i]);return n}function w(){var t,e=((t=g(location.search)).delete("authToken"),t.delete("code"),t.delete("state"),t.delete("session_state"),t.toString());return e?"?"+e:""}function y(t){window.location.replace(t)}function S(t,e,n){var i=decodeURIComponent(t);return decodeURIComponent(i+(/\?\S+$/.test(i)?"&":"?")+e+"="+n)}function T(){var t=window.location.pathname+w();window.history.replaceState({},"",t)}function I(t){void 0===t&&(t=location.search);var e=g(t);return{authToken:e.get("authToken"),code:e.get("code"),state:e.get("state"),sessionState:e.get("session_state")}}function b(){return window.location.href.split("?")[0]+w()}function C(t){return(t||"").replace(/^\/|\/$/g,"")}function E(t){var e=document.getElementById(t);e&&e.remove()}function A(t){var e=document.createElement("iframe");return e.style.width="0px",e.style.height="0px",e.style.position="absolute",e.style.left="-4000px",e.src=t,e}function _(t){document.body?document.body.appendChild(t):document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(t)})}function R(t){window.top===window.self&&localStorage.setItem(v,t)}var k=(O.get=function(t){return new O(t,"GET")},O.post=function(t){return new O(t,"POST")},O.put=function(t){return new O(t,"PUT")},O.delete=function(t){return new O(t,"DELETE")},O.prototype.send=function(t,e,a){var u,c=this;void 0===a&&(a=[401]);var n=this.httpRequest,i=this.method,o=new Promise(function(r,s){n.addEventListener("load",function(t){var e=t.target,n=e.status,i=e.response,o=c.parseResponse(i);-1!==a.indexOf(n)||o&&!1===o.success||o.errorCode?s(o):(u&&clearTimeout(u),r(o))}),n.addEventListener("error",function(t){var e=t.target.response;s(c.parseResponse(e))})});return n.open(i,this.getRequestUrl(t),!0),this.applyHeaders(),n.send(t),e&&(u=setTimeout(function(){var t=new CustomEvent("error");n.dispatchEvent(t),n.abort()},e)),o},O.prototype.sendAsJSON=function(t){return this.setHeaders("Content-Type","application/json").send(JSON.stringify(t))},O.prototype.sendAsFormUrlEncoded=function(t){var e=g(t);return this.setHeaders("Content-Type","application/x-www-form-urlencoded").send(e.toString())},O.prototype.withCredentials=function(t){return this.httpRequest.withCredentials=t,this},O.prototype.setHeaders=function(t,e){return this.headers[t]=e,this},O.prototype.parseResponse=function(e){try{return JSON.parse(e)}catch(t){return e}},O.prototype.getRequestUrl=function(t){if("GET"!==this.method)return this.url;var e=!t||Object.keys(t).length<1?"":"?"+g(t);return this.url+e},O.prototype.applyHeaders=function(){for(var t in this.headers){var e;this.headers.hasOwnProperty(t)&&(e=this.headers[t],this.httpRequest.setRequestHeader(t,e))}},O);function O(t,e){this.url=t,this.method=e,this.httpRequest=new XMLHttpRequest,this.headers={}}var U,P,L="storage",F="EXPIRES_IN",x=1e3,z="ROLES_MISSING",j="authenticateErrorHandler",q="business",N="https://business.tinkoff.ru/account?access=denied",M="/account?access=denied",D="https://www.tinkoff.ru/business/",H="https://business",W="redirectReason";function V(){return window.TCS||{}}function Z(t){return(V().appName?"/"+C(V().appName):"")+"/"+t}function G(){return V().appName}function J(){return V().project===q||"account/appx"===G()||"account"===G()}(P=U=U||{}).VALIDATE_REQUEST_ERROR="validateReqError",P.NO_ROLES="noRoles",P.UNKNOWN="unknown";var K="/api/authorization/authorize",$=V().ssoUrl,B=$+"/auth/frame/op.html",Q=(X.prototype.init=function(t){this.frame=A(t),_(this.frame)},X.prototype.reset=function(){document.body&&document.body.contains(this.frame)&&document.body.removeChild(this.frame)},X.prototype.getFrame=function(){return this.frame},X);function X(){}function Y(t){return"authSessionState["+t+"]"}var tt=(et.prototype.initialize=function(){return!(!this.authClientId||!this.sessionState||(this.ssoOrigin?(this.saveSessionStateToCache(),this.stopSessionChecking(),this.initOpFrame(),this.initCheckSession(),0):(console.error("window.TCS должен содержать ssoUrl! Например: https://id.tinkoff.ru"),1)))},et.prototype.initWithSessionState=function(t){return!!t&&(this.sessionState=t,this.initialize())},et.prototype.initWithAuthClientId=function(t){return!!t&&(this.authClientId=t,this.sessionState=this.sessionState||this.getSessionStateFromCache(),this.initialize())},et.prototype.reset=function(){this.authClientId=null,this.sessionState=null,this.stopSessionChecking()},et.prototype.getSessionStateFromCache=function(){return localStorage.getItem(Y(this.authClientId))||""},et.prototype.saveSessionStateToCache=function(){localStorage.setItem(Y(this.authClientId),this.sessionState)},et.prototype.stopSessionChecking=function(){this.hiddenFrameService.reset(),null!==this.sessionCheckTimer&&(window.clearInterval(this.sessionCheckTimer),window.removeEventListener("message",this.onMessageFromOp,!1),this.sessionCheckTimer=null)},et.prototype.initOpFrame=function(){this.hiddenFrameService.init(this.opFrameUrl)},et.prototype.initCheckSession=function(){window.addEventListener("message",this.onMessageFromOp,!1),this.sessionCheckTimer=window.setInterval(this.checkSession,this.sessionCheckInterval)},et);function et(t,e,n,i){var o=this;void 0===e&&(e=$),void 0===n&&(n=B),void 0===i&&(i=3e3),this.onSessionChangedCallback=t,this.ssoOrigin=e,this.opFrameUrl=n,this.sessionCheckInterval=i,this.sessionCheckTimer=null,this.hiddenFrameService=new Q,this.checkSession=function(){var t=o.authClientId+" "+o.sessionState;o.hiddenFrameService.getFrame().contentWindow.postMessage(t,o.ssoOrigin)},this.onMessageFromOp=function(t){t.origin===o.ssoOrigin&&"changed"===t.data&&(o.stopSessionChecking(),o.onSessionChangedCallback())}}var nt=(it.prototype.authorize=function(){var n=this;this.validate().then(function(t){n.onAuthDataReceived(t);var e=n.sessionStatusChangeService.getSessionStateFromCache();n.sessionStatusChangeService.initWithSessionState(e)}).catch(function(){return n.authorizeInFrame()})},it.prototype.reset=function(){this.accessTokenService.reset(),this.sessionStatusChangeService.reset(),this.authData=null},it.prototype.onAuthDataReceived=function(t){var e=this;(this.authData=t)&&t.expires_in&&this.accessTokenService.initialize(t.expires_in,function(t){return e.authorizeInFrame(t)}),this.onAuthorizationSuccess(),this.sendAuthData(t)},it.prototype.sendAuthData=function(e){setTimeout(function(){var t=new CustomEvent(l,{detail:e});window.dispatchEvent(t)})},it.prototype.onAuthDataRequest=function(){this.authData&&this.sendAuthData(this.authData)},it.prototype.logout=function(){return k.post(V().ssoUrl+"/auth/logout").withCredentials(!0).send()},it.prototype.updateAppInfo=function(t){this.setAppInfo(t),t.watchToSessionChange&&this.sessionStatusChangeService.initWithAuthClientId(t.authClientId)},it.prototype.onAuthorizationSuccess=function(){window.dispatchEvent(new CustomEvent("authorizationSuccess"))},it.prototype.onAuthorizationFailed=function(){this.appInfo.supportsUnauthorizedZone?window.dispatchEvent(new CustomEvent("authorizationFailed")):this.redirectToSSO()},it.prototype.setAppInfo=function(t){this.appInfo=t},it);function it(t){var e=this;this.appInfo=t,this.authFrameService=new Q,this.onSessionStatusChanged=function(){e.accessTokenService.initTokenUpdate(!0)},this.sessionStatusChangeService=new tt(this.onSessionStatusChanged),t.watchToSessionChange&&this.sessionStatusChangeService.initWithAuthClientId(t.authClientId)}var ot="PROLONGATION_TOKEN_IN_PROGRESS",rt=1e4,st=6e4,at=(ut.prototype.startUpdateTimer=function(t){var e=this;this.resetUpdateTimer();var n=Math.max(t*x-st,0);this.timer=setTimeout(function(){e.initTokenUpdate()},n)},ut.prototype.resetUpdateTimer=function(){this.timer&&clearTimeout(this.timer)},ut.prototype.reset=function(){this.resetUpdateTimer()},ut);function ut(){}var ct,pt=(o(ht,ct=at),ht.prototype.initialize=function(t,e){this.initUpdateTokenFrame=function(){return e(!0)},this.startUpdateTimer(t)},ht.prototype.initTokenUpdate=function(){this.initUpdateTokenFrame()},ht);function ht(){return null!==ct&&ct.apply(this,arguments)||this}var dt,ft=(o(lt,dt=nt),Object.defineProperty(lt.prototype,"apiPrefix",{get:function(){return this.appInfo.apiPrefix?this.isApiPrefixAbsolute?this.appInfo.apiPrefix:"/"+this.appInfo.apiPrefix:""},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"completeUri",{get:function(){return g("complete_uri="+(this.isApiPrefixAbsolute?this.apiPrefix:""+location.origin+this.apiPrefix)+"/api/authorization/complete").toString()},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"postCompleteUri",{get:function(){return g("post_complete_redirect_uri="+(this.isApiPrefixAbsolute?this.apiPrefix:location.origin)+"/common/auth/complete.html").toString()},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"validateUri",{get:function(){return this.apiPrefix+"/api/authorization/validate"},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"authorizeSrc",{get:function(){return this.apiPrefix+K+"?"+this.completeUri+"&"+this.postCompleteUri+"&prompt=none"},enumerable:!0,configurable:!0}),lt.prototype.authorize=function(t){T(),dt.prototype.authorize.call(this)},lt.prototype.validate=function(){return k.get(this.validateUri).withCredentials(!0).send(void 0,null,[401,403])},lt.prototype.redirectToSSO=function(){var t=g("post_complete_redirect_uri="+b()).toString();window.location.replace(this.apiPrefix+K+"?"+t+"&"+this.completeUri)},lt.prototype.authorizeInFrame=function(t){this.listenAuthFrame(t),this.authFrameService.init(this.authorizeSrc)},lt.prototype.listenAuthFrame=function(e){var n=this;this.removeAuthFrameListener(),this.authFrameListener=function(t){return n.onAuthFrameMessage(t,e)},window.addEventListener("message",this.authFrameListener)},lt.prototype.onAuthorized=function(){var e=this;this.validate().then(function(t){return e.onAuthDataReceived(t)}).catch(function(){return e.onValidateError()})},lt.prototype.onAuthFrameMessage=function(t,e){var n=this,i=t.data;i&&"authComplete"===i.messageCode&&(this.authFrameService.reset(),i.data.success?(i.data.sessionState&&this.sessionStatusChangeService.initWithSessionState(i.data.sessionState),e?this.validate().then(function(t){return n.accessTokenService.startUpdateTimer(t.expires_in)}).catch(function(){return n.onValidateError()}):this.onAuthorized()):this.onAuthorizationFailed())},lt.prototype.onValidateError=function(){this.appInfo.supportsUnauthorizedZone||(J()?y(S(D,W,U.VALIDATE_REQUEST_ERROR)):y(S(N,W,U.VALIDATE_REQUEST_ERROR)))},lt.prototype.removeAuthFrameListener=function(){window.removeEventListener("message",this.authFrameListener)},lt);function lt(t){var e=dt.call(this,t)||this;return e.appInfo=t,e.isApiPrefixAbsolute=/^https?:\/\//i.test(e.appInfo.apiPrefix),e.accessTokenService=new pt,e}var mt="api/v1/session/validate";function vt(t,e){void 0===t&&(t=Z(mt));var n=k.get(t).withCredentials(!0);return e&&n.setHeaders(v,e),n.send().then(function(t){return t.result})}var gt="api/v1/session/authorize",wt="none";function yt(t,e){return void 0===e&&(e=St()),k.get(e).setHeaders("Accept","application/json").withCredentials(!0).send(t)}function St(){return Z(gt)}function Tt(){y(St()+"?"+g({returnTo:b()}))}function It(){y(St()+"?"+g({prompt:"login"}))}var bt="authErrorResponse",Ct="authParamsResponse";function Et(a,u,c,p){void 0===c&&(c=I),window.addEventListener("message",function(t){var e,n,i,o,r,s;"object"==typeof t.data&&(n=(e=t.data).messageCode,(i=e.data)&&n&&(r=(o=c(i)).code,s=o.state,n===Ct&&s===a&&(u({code:r,state:s}),E(p))))})}function At(i,o,r){window.addEventListener("message",function(t){var e,n;"object"==typeof t.data&&(e=t.data.messageCode,n=t.data.data,e===bt&&n.state===i&&(o(n.error),E(r)))})}var _t="/common/auth/checkAuth.html";function Rt(r,s,t,e,n,i,a,u,c,p){void 0===e&&(e=St()),void 0===n&&(n=location.origin),void 0===i&&(i=yt),void 0===a&&(a=kt),void 0===u&&(u=Et),void 0===c&&(c=At),void 0===p&&(p=Ot);var o={returnTo:n+_t,prompt:wt};t&&(o.authToken=t),i(o,e).then(function(t){var e,n,i,o=t.redirectUrl;o?(e=I(o.split("?")[1]).state,n=p(o),i=Date.now().toString(),u(e,r,void 0,i),c(e,s,i),a(n,i)):It()})}function kt(t,e){var n=A(t);n.id=e,_(n)}function Ot(t){var e=t.split("?"),n=e[0],i=g(e[1]);return i.delete("display"),i.delete("response_mode"),i.set("redirect_on_error","true"),n+"?"+i.toString()}var Ut="api/v1/session/ssoLogin";function Pt(t,e){return void 0===e&&(e=Z(Ut)),k.get(e).withCredentials(!0).send(t).then(function(t){return t.result})}var Lt,Ft=(o(xt,Lt=at),xt.prototype.initialize=function(t,e){this.initUpdateTokenFrame=function(){return e(!0)},this.startUpdateTimer(t),this.listenTokenUpdate()},xt.prototype.reset=function(){Lt.prototype.reset.call(this),this.removeTokenUpdateListener()},xt.prototype.initTokenUpdate=function(t){var e=this;void 0===t&&(t=!1);var n=localStorage.getItem(ot);if(!t||!this.initUpdateTokenFrame)return n?void setTimeout(function(){localStorage.getItem(ot)?e.initUpdateTokenFrame():e.startUpdateTimer(Number(localStorage.getItem(F)))},rt):(localStorage.setItem(ot,"true"),void this.initUpdateTokenFrame());this.initUpdateTokenFrame()},xt.prototype.updateSessionInSidebar=function(t){var e=document.querySelector('[automation-id="sidebar-iframe"]');e&&e.contentWindow&&e.contentWindow.postMessage({messageCode:"authDataEvent",data:{user:t}},"*")},xt.prototype.updateSessionInMessenger=function(t){var e=window["t-messenger"];e&&e.api&&e.api.updateSession&&e.api.updateSession(t.sessionId)},xt.prototype.removeTokenUpdateListener=function(){window.removeEventListener(L,this.onTokenUpdateCallback)},xt.prototype.listenTokenUpdate=function(){window.addEventListener(L,this.onTokenUpdateCallback)},xt.prototype.onUpdateInAnotherTab=function(t){t.key===v&&this.startUpdateTimer(Number(localStorage.getItem(F)))},xt);function xt(){var t=null!==Lt&&Lt.apply(this,arguments)||this;return t.onTokenUpdateCallback=t.onUpdateInAnotherTab.bind(t),t}function zt(t){var e;V().hasAuthenticateErrorHandler?(e=new CustomEvent(j,{detail:t}),window.dispatchEvent(e)):y(function(t){function e(t){return S(t,W,U.NO_ROLES)}var n=!!t&&t.errorCode===z,i=J(),o=0===window.location.href.indexOf(H);switch(!0){case n&&i:return e(D);case n&&o:return e(M);case n&&!o:return e(N);default:return S(D,W,function(t){var e=t&&t.requestId,n=t&&t.message,i=e||n;return"string"==typeof i?i:U.UNKNOWN}(t))}}(t))}var jt,qt=(o(Nt,jt=nt),Nt.prototype.authorize=function(){this.resolveAuthentication()||jt.prototype.authorize.call(this)},Nt.prototype.validate=function(){return vt()},Nt.prototype.ssoLogin=function(t){return Pt(t)},Nt.prototype.authorizeInFrame=function(o,t){var r=this,e={returnTo:location.origin+"/common/auth/checkAuth.html",prompt:wt};t&&(e.authToken=t),yt(e,St()).then(function(t){var e,n,i=t.redirectUrl;i||r.appInfo.supportsUnauthorizedZone?(e=I(i.split("?")[1]).state,n=Ot(i),r.listenAuthFrame(e,o),r.authFrameService.init(n)):It()})},Nt.prototype.onAuthorized=function(t){var e=this,n=t.code,i=t.state;(n&&i?this.ssoLogin(t):Promise.reject(null)).then(function(t){return t.sessionId&&(localStorage.setItem(F,""+t.expires_in),R(t.sessionId)),t}).then(function(t){return e.onAuthDataReceived(t)}).catch(zt)},Nt.prototype.redirectToSSO=function(){Tt()},Nt.prototype.reset=function(){jt.prototype.reset.call(this),this.removeAuthFrameListener()},Nt.prototype.onTokenUpdate=function(t){var e=this;this.ssoLogin(t).then(function(t){localStorage.removeItem(ot),localStorage.setItem(F,""+t.expires_in),R(t.sessionId),e.accessTokenService.updateSessionInSidebar(t),e.accessTokenService.updateSessionInMessenger(t),e.accessTokenService.startUpdateTimer(t.expires_in)})},Nt.prototype.listenAuthFrame=function(e,n){var i=this;this.removeAuthFrameListener(),this.authFrameListener=function(t){return i.onAuthFrameMessage(t,e,n)},window.addEventListener("message",this.authFrameListener)},Nt.prototype.removeAuthFrameListener=function(){window.removeEventListener("message",this.authFrameListener)},Nt.prototype.onAuthFrameMessage=function(t,e,n){var i,o,r;t.data&&t.data.messageCode&&t.data.data&&(o=(i=t.data).messageCode,r=i.data,o===Ct&&I(r).state===e&&this.onAuthFrameSuccess(r,n),o===bt&&r.state===e&&this.onAuthorizationFailed())},Nt.prototype.onAuthFrameSuccess=function(t,e){var n=I(t),i=n.code,o=n.state,r=n.sessionState;this.sessionStatusChangeService.initWithSessionState(r),e?this.onTokenUpdate({code:i,state:o}):this.onAuthorized({code:i,state:o}),this.authFrameService.reset(),this.removeAuthFrameListener()},Nt.prototype.resolveAuthentication=function(){var t=I(),e=t.authToken,n=t.code,i=t.state,o=t.sessionState;return this.sessionStatusChangeService.initWithSessionState(o),e?(T(),this.authorizeInFrame(void 0,e),!0):!(!n||!i||(T(),this.onAuthorized({code:n,state:i}),0))},Nt);function Nt(t){var e=jt.call(this,t)||this;return e.appInfo=t,e.accessTokenService=new Ft,e}var Mt=(Dt.getInstance=function(t){return new(t.isNewSSO?ft:qt)(t)},Dt);function Dt(){}var Ht=(Wt.prototype.replaceClientService=function(t){this.clientService.reset(),this.clientService=Mt.getInstance(t),this.clientService.authorize()},Wt.prototype.handleAuthStart=function(){var r=this;window.addEventListener("authorizationStart",function(t){var e,n,i,o=t.detail;o&&(e=o.apiPrefix,n=o.isNewSSO,i=o.supportsUnauthorizedZone,r.appInfo={apiPrefix:e,isNewSSO:n,supportsUnauthorizedZone:i},r.replaceClientService(r.appInfo))})},Wt);function Wt(t,e){this.appInfo=t,this.clientService=e,this.handleAuthStart()}var Vt;o(Zt,Vt=Ht),Zt.prototype.listenAppChange=function(){var u=this;window.addEventListener("appChanged",function(t){var e,n,i,o,r,s,a;t.detail&&(n=(e=t.detail).appName,i=e.isNewSSO,o=e.authClientId,r=e.watchToSessionChange,s=e.supportsUnauthorizedZone,a={apiPrefix:C(n||""),isNewSSO:i,authClientId:o,watchToSessionChange:r,supportsUnauthorizedZone:s},u.onAppInfoChanged(a))})},Zt.prototype.listenAuthorizeRequest=function(){var t=this;window.addEventListener("authorizeRequest",function(){t.clientService.reset(),t.clientService.authorize()})},Zt.prototype.initRequestListeners=function(){this.listenAuthDataRequest(),this.listenLoginRequest(),this.listenLogoutRequest(),this.listenToLoginRequest(),this.listenValidateRequest()},Zt.prototype.listenAuthDataRequest=function(){var t=this;window.addEventListener(f,function(){return t.clientService.onAuthDataRequest()})},Zt.prototype.listenValidateRequest=function(){var t=this;this.addHandler(r,s,function(){return t.clientService.validate()})},Zt.prototype.listenLogoutRequest=function(){var t=this;this.addHandler(a,u,function(){return t.clientService.logout()})},Zt.prototype.listenLoginRequest=function(){var t=this;this.appInfo.isNewSSO&&this.addHandler(c,p,function(){return t.clientService.ssoLogin()})},Zt.prototype.listenToLoginRequest=function(){var t=this;this.addHandler(h,d,function(){return t.clientService.redirectToSSO()})},Zt.prototype.addHandler=function(t,n,i){var o=this;window.addEventListener(t,function(t){var e=o.appInfo.apiPrefix;Promise.resolve(null).then(function(){return i(t&&t.detail||void 0)}).then(function(t){e===o.appInfo.apiPrefix&&o.sendResponse(n,t)}).catch(function(t){e===o.appInfo.apiPrefix&&o.sendResponse(n,t)})})},Zt.prototype.sendResponse=function(t,e){var n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)},Zt.prototype.onAppInfoChanged=function(t){var e=this.appInfo.apiPrefix!==t.apiPrefix;this.appInfo=t,e?this.replaceClientService(this.appInfo):this.clientService.updateAppInfo(this.appInfo)};function Zt(t,e){var n,i,o,r;void 0===t&&(n=V(),i=n.appName,o=n.isNewSSO,r=n.supportsUnauthorizedZone,t={apiPrefix:C(i),isNewSSO:o,supportsUnauthorizedZone:r}),void 0===e&&(e=Mt.getInstance(t));var s=Vt.call(this,t,e)||this;return s.appInfo=t,s.clientService=e,s.initRequestListeners(),s.listenAppChange(),s.listenAuthorizeRequest(),s.clientService.authorize(),s}var Gt,Jt={apiPrefix:"",isNewSSO:!0};o(Kt,Gt=Ht);function Kt(t,e){void 0===t&&(t=Jt),void 0===e&&(e=new ft(t));var n=Gt.call(this,t,e)||this;return n.appInfo=t,n.clientService=e,n}function $t(t,e,n,i){void 0===n&&(n=Rt);var o=void 0===i?I():i,r=o.authToken,s=o.code,a=o.state;return r?(T(),n(t,e,r),!0):!(!s||!a)&&(T(),t({code:s,state:a}),!0)}window;var Bt=n(2);var Qt,Xt,Yt,te,ee="USER_NOT_MIGRATED",ne="AUTH_SUCCESS",ie="AUTH_ERROR",oe=["app=bank","app=invest"];(Xt=Qt=Qt||{}).TmsgPlatformUserResponse="tmsg-platform-user-response",Xt.TmsgPlatformUserRequest="tmsg-platform-user-request",Xt.TmsgUrlResponse="tmsg-url-response",Xt.TmsgUrlRequest="tmsg-url-request",(te=Yt=Yt||{}).Platform="app/bank",te.Invest="app/invest",te.HrRabota="app/hr_rabota",te.EmployeeSupport="app/employee_support",te.Kids="app/kids",te.Default="app/default";var re,se,ae,ue,ce="messengerInitEvent",pe=1800,he=!1,de=!1,fe=null,le=null;function me(){he&&we(),de=!0}function ve(t){he=!0,le=t,window.parent.postMessage({messageCode:ne,data:t},"*"),function(t){fe&&clearTimeout(fe);fe=setTimeout(function(){clearTimeout(fe),window.authorizeMessenger()},0<t*x-st?t*x-st:0)}(t&&t.expires_in||pe),de&&we()}function ge(){window.parent.postMessage({messageCode:ie},"*")}function we(){var t=new CustomEvent(ce,{detail:le});window.dispatchEvent(t)}function ye(){var i,e=(i=Pt,function(t){var e=t.code,n=t.state;(e&&n?i(t):Promise.reject(null)).then(ve).catch(function(t){return Se(t,function(){we()})})});window.authorizeMessenger=function(){Rt(e,ve)},$t(e,ve)||vt().then(function(t){t?ve(t):Rt(e,ve)}).catch(function(t){return Se(t,function(){Rt(e,ve)})})}function Se(t,e){t&&t.errorCode===ee?window.parent.postMessage({messageCode:ee,data:t},"*"):e()}function Te(n){window.addEventListener("message",function t(e){e.data&&e.data.messageCode===Qt.TmsgPlatformUserResponse&&(window.authorizeMessenger=function(){Ie(n,e.data.data)},Ie(n,e.data.data).then(function(t){ve(t)}).catch(function(t){return Se(t,ge)}),window.removeEventListener("message",t))}),window.parent.postMessage({messageCode:Qt.TmsgPlatformUserRequest},"*")}function Ie(t,e){var n=e||{},i=t.match("app[/=](.*)")[1];return k.post("/app/"+i+"/api/v1/session/issueTokenByWEBIMWeb").sendAsJSON(n).then(function(t){return t.result})}function be(t){switch(t){case Yt.Platform:case Yt.Invest:case Yt.HrRabota:case Yt.EmployeeSupport:case Yt.Kids:Te(t);break;case Yt.Default:!function(){if(window.parent!==window)return window.addEventListener("message",function t(e){var n,i;e.data&&e.data.messageCode===Qt.TmsgUrlResponse&&(i=(n=e.data.data.match("app=[a-zA-Z]+"))&&n[0],-1!==oe.indexOf(i)?Te(i):ye(),window.removeEventListener("message",t))}),window.parent.postMessage({messageCode:Qt.TmsgUrlRequest},"*");ye()}();break;default:ye()}}function Ce(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}(se=re=re||{}).Sso="sso",se.Webim="webim","function"!=typeof window.CustomEvent&&(Ce.prototype=window.Event.prototype,window.CustomEvent=Ce),window.Promise||(window.Promise=Bt.Promise),function(){var n=this;"localStorage"in window||Object.defineProperty(window,"localStorage",{value:{_data:{},setItem:function(t,e){return n._data[t]=String(e)},getItem:function(t){return n._data.hasOwnProperty(t)?n._data[t]:void 0},removeItem:function(t){return delete n._data[t]},clear:function(){return n._data={}}}})}(),"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),window.addEventListener(f,me),ae=G(),(ue=V().authSystem||null)?function(t,e){switch(t){case re.Sso:ye();break;case re.Webim:Te(e);break;default:be(e)}}(ue,ae):be(ae)}]);