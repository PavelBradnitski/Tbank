(()=>{"use strict";var e,s,t,n,i,r,o,a,c,g,m,d,l;!function(e){e.InitTmsg="initTmsg",e.OpenMessenger="openMessenger",e.ToggleMessenger="toggleMessenger",e.CloseMessenger="closeMessenger"}(e||(e={})),function(e){e.Business="business",e.Accounting="accounting",e.Bank="bank",e.Kids="kids",e.Invest="invest",e.Carloans="tcb_carloans",e.HrRabota="hr_rabota",e.Dolyame="dolyami",e.Mobile="mvno"}(s||(s={})),function(e){e.Sso="sso",e.Webim="webim"}(t||(t={})),function(e){e.OnMessengerFail="ON_MESSENGER_FAIL",e.OnMessengerInited="ON_MESSENGER_INITED",e.OnMessengerClose="ON_MESSENGER_CLOSE",e.OnMessengerOpen="ON_MESSENGER_OPEN",e.OnUnreadIndicatorChanged="ON_UNREAD_INDICATOR_CHANGED",e.OnUnreadMessagesCountChanged="ON_UNREAD_MESSAGES_COUNT_CHANGED",e.OnMessengerUpdateSession="ON_MESSENGER_UPDATE_SESSION",e.OnMessengerScreenChanged="ON_MESSENGER_SCREEN_CHANGED"}(n||(n={})),function(e){e.Conversation="conversation",e.Error="error",e.ConversationsList="conversations-list",e.WelcomeForm="welcome-form",e.ArchiveList="archive-list",e.WidgetLongVersion="widget-long-version"}(i||(i={})),function(e){e.Auto="auto",e.Visible="visible",e.Hidden="hidden",e.SingleConversationOnly="singleConversationOnly"}(r||(r={})),function(e){e.IframeLoad="iframeLoad"}(o||(o={})),function(e){e.Resize="resize"}(a||(a={})),function(e){e.MessengerOpenedStatus="messengerOpenedStatus",e.UpdateCompanyId="update-companyId",e.UpdateLocation="update-location",e.TmsgUserInfo="tmsg-userInfo",e.UpdateApplications="update-applications",e.UpdateUnreadCounter="updateUnreadCounter",e.UpdateUnreadMessagesCount="updateUnreadMessagesCount",e.FocusEvent="focus-event",e.PushNotification="push-notification",e.OpenConversationById="open-conversation-by-id",e.OpenConversationByAppId="open-conversation-by-app-id",e.OpenSupportConversation="open-support-conversation",e.TmsgOpenDraft="tmsg-openDraft",e.PlatformResize="platformResize",e.TmsgSendMessage="tmsg-send-message",e.TmsgWidgetTitle="tmsg-widget-title",e.TmsgWidgetSubtitle="tmsg-widget-subtitle",e.TmsgWidgetAvatar="tmsg-widget-avatar",e.TmsgColorConfig="tmsg-color-config",e.TmsgWelcomeFormConfig="tmsg-welcome-form-config",e.TmsgCloseButtonVisibility="tmsg-close-button-visibility",e.TmsgInit="tmsg-init",e.TmsgClose="tmsg-close",e.TmsgUpdateSession="tmsg-update-session",e.TmsgWelcomeFormDisplayStatus="tmsg-welcome-form-display-status",e.TmsgWelcomeFormScreenChanged="tmsg-welcome-form-screen-changed",e.TmsgScreenChanged="tmsg-screen-changed",e.UpdateLocale="tmsg-update-locale",e.TmsgPlatformUserResponse="tmsg-platform-user-response",e.TmsgPlatformUserRequest="tmsg-platform-user-request",e.TmsgUrlResponse="tmsg-url-response",e.TmsgUrlRequest="tmsg-url-request",e.TmsgButtonInited="tmsg-button-inited"}(c||(c={})),function(e){e.Notify="NOTIFY",e.RecalculateActiveTab="RECALCULATE_ACTIVE_TAB"}(g||(g={})),function(e){e.Desktop="desktop",e.WebMobile="web_mobile",e.PWA="pwa",e.Unknown="unknown"}(m||(m={})),function(e){e.Name="name",e.Phone="phone",e.Email="email",e.Date="date"}(d||(d={})),function(e){e.First="first",e.Second="second"}(l||(l={}));const h={telegram:"https://business.cdn-tinkoff.ru/static/projects/messenger/icons/messengers/telegram.svg",viber:"https://business.cdn-tinkoff.ru/static/projects/messenger/icons/messengers/viber.svg",whatsapp:"https://business.cdn-tinkoff.ru/static/projects/messenger/icons/messengers/whatsapp.svg"},p={telegram:"\u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c",viber:"Viber",whatsapp:"WhatsApp"};var u,v,M,S,f,b;!function(e){e.Opened="messenger-button messenger-opened",e.Closed="messenger-button messenger-closed",e.Hidden="messenger-button messenger-button-hidden"}(u||(u={})),function(e){e.Opened="messenger-frame messenger-frame-opened",e.Closed="messenger-frame messenger-frame-closed"}(v||(v={})),function(e){e.Visible="messenger-preloader",e.Hidden="messenger-preloader messenger-preloader-hidden"}(M||(M={})),function(e){e.Visible="unread-indicator",e.Hidden="unread-indicator unread-indicator-hidden"}(S||(S={})),function(e){e.FirstScreen="welcome-form welcome-form_first-screen",e.SecondScreen="welcome-form welcome-form_second-screen"}(f||(f={})),function(e){e.Opened="tmsg-messengers-list-container tmsg-messengers-list-container_opened",e.Closed="tmsg-messengers-list-container tmsg-messengers-list-container_closed"}(b||(b={}));const C={backgroundColor:"#ffdd2d",backgroundHoverColor:"#fcc521",backgroundActiveColor:"#fab619",unreadIndicatorColor:"#e31c1c",iconOpen:"data:image/svg+xml;base64,PHN2ZyBmb2N1c2FibGU9ImZhbHNlIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgaGVpZ2h0PSIzMiIgd2lkdGg9IjMyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iaWRfNzQzMjU0MDY2NTQ4X3BhaW50MF9saW5lYXJfMTUyNV81NjYiIHgxPSIxMS43NSIgeTE9IjQuNSIgeDI9IjIyLjY4OTQiIHkyPSIyMi41ODI5IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICAgIDxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciI+PC9zdG9wPgogICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3Atb3BhY2l0eT0iMC43IiBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiPjwvc3RvcD4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgoKICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEuNSA0LjVIMTcuNUMxOS45ODUzIDQuNSAyMiA2LjUxNDcyIDIyIDlWMjNMMTkuNzU1NiAyMC41OTE0QzE4LjgwOTggMTkuNTc2NCAxNy40ODQ5IDE5IDE2LjA5NzYgMTlINkMzLjUxNDcyIDE5IDEuNSAxNi45ODUzIDEuNSAxNC41VjQuNVpNNiAxMUM2IDkuMzQzMTggNy4zNDMxNSA4LjAwMDAzIDkgOC4wMDAwM0gxN0MxNyA5LjY1Njg4IDE1LjY1NjkgMTEgMTQgMTFINlpNOSAxM0M3LjM0MzE1IDEzIDYgMTQuMzQzMiA2IDE2SDEwQzExLjY1NjkgMTYgMTMgMTQuNjU2OSAxMyAxM0g5WiIgZmlsbD0idXJsKCNpZF83NDMyNTQwNjY1NDhfcGFpbnQwX2xpbmVhcl8xNTI1XzU2NikgcmdiYSgwLCAwLCAwLCAwLjcpIj48L3BhdGg+CiAgPHBhdGggb3BhY2l0eT0iMC4zIiBkPSJNNiAxNkM2IDE0LjM0MzEgNy4zNDMxNSAxMyA5IDEzSDEzQzEzIDE0LjY1NjkgMTEuNjU2OSAxNiAxMCAxNkg2WiIgZmlsbD0iY3VycmVudENvbG9yIj48L3BhdGg+Cjwvc3ZnPg==",iconClose:"data:image/svg+xml;base64,PHN2ZyBmb2N1c2FibGU9ImZhbHNlIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgaGVpZ2h0PSIzMiIgd2lkdGg9IjMyIj4KICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEyIDEzLjM5OTZMMTcuNjAwMSAxOUwxOSAxNy42TDEzLjM5OTkgMTEuOTk5NkwxOC45OTkzIDYuNEwxNy41OTkzIDVMMTIgMTAuNTk5Nkw2LjQwMDY2IDVMNS4wMDA3NCA2LjRMMTAuNjAwMSAxMS45OTk2TDUgMTcuNkw2LjM5OTkzIDE5TDEyIDEzLjM5OTZaIiBmaWxsPSJjdXJyZW50Q29sb3IiPjwvcGF0aD4KPC9zdmc+"};const I="\n    .welcome-form.welcome-form_first-screen {\n        height: 144px;\n        min-height: 144px\n    }\n    .welcome-form.welcome-form_second-screen.welcome-form_1-control {\n        height: 316px;\n        min-height: 316px\n    }\n    .welcome-form.welcome-form_second-screen.welcome-form_2-control {\n        height: 372px;\n        min-height: 372px\n    }\n    .welcome-form.welcome-form_second-screen.welcome-form_3-control {\n        height: 430px;\n        min-height: 430px\n    }";const w={invest:["web_terminal","PF_trading_aut"],accounting:["accounting"],tcb_carloans:["carloans_help"],hr_rabota:["rmr_wof_hr","DKO_EL_CLOUD_INV_PERVICHKA","DKO_EL_CLOUD_OKK_PERVICHKA","DKO_EL_CLOUD_SME_PERVICHKA","DKO_EL_CLOUD_TM_PERVICHKA","DKO_EL_CLOUD_TM_SAVE_PERVICHKA","DKO_EL_CLOUD_TC_PERVICHKA","HCC_EL_KNZ","HCC_EL_UOP","HCC_EL_USP","help_recruiting","learn_recruiting","e-learning_sme_ab_test","elearningsmeabtest","Partners_KK","Partners_KNZ","Partners_SU","WT_collection","WT_collection_wg","b2b_education","verif_chat","Internet_acquiring","identification_chat","education_chat_1","education_chat_2","candidate_loginform_lkk_old","candidate_lkk_old_auth"],tinkoff_edu:["fintech"],kids:["junior_web_auth"],hotel:["travel_booking","hotel_web_auth","hotel_web_noauth"]};var _,O,y,E,T;!function(e){e.ReadOnly="readOnly",e.Open="open"}(_||(_={})),function(e){e.Delivery="delivery",e.Appeal="appeal"}(O||(O={})),function(e){e.Support="support",e.Bot="bot",e.PersonalSupport="personal_support",e.Thread="thread",e.Group="group",e.P2P="p2p",e.Channel="channel"}(y||(y={})),function(e){e.Business="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0411\u0438\u0437\u043d\u0435\u0441",e.Accounting="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0411\u0443\u0445\u0433\u0430\u043b\u0442\u0435\u0440\u0438\u044f",e.Bank="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0411\u0430\u043d\u043a",e.Invest="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0418\u043d\u0432\u0435\u0441\u0442\u0438\u0446\u0438\u0438",e.Carloans="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0410\u0432\u0442\u043e\u043a\u0440\u0435\u0434\u0438\u0442\u044b",e.HrRabota="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0420\u0430\u0431\u043e\u0442\u0430",e.Dolyame="\u0414\u043e\u043b\u044f\u043c\u0438",e.Junior="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 Junior",e.Mobile="\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u041c\u043e\u0431\u0430\u0439\u043b"}(E||(E={})),function(e){e.Restaurant="restaurant",e.Movie="movie",e.Spectacle="spectacle",e.Theatre="theatre",e.Concert="concert",e.ConcertHall="concert_hall",e.SportEvent="sport_event"}(T||(T={}));const k="https://business.t-static.ru/static/projects/messenger/icons",N=`${k}/lifestyle`,x=`${k}/business-lines`,P=`${x}/bank.png`,A=`${x}/business.png`,U=P;s.Invest,s.Accounting,s.Business,s.Mobile,s.Bank,s.Kids,s.Dolyame,T.Restaurant,T.Movie,T.Spectacle,T.Theatre,T.Concert,T.ConcertHall,T.SportEvent;var L,D,W,z,F,j,B,Z,R,V,H,G,Q,K,Y,$,J,X;!function(e){e.InProgress="inProgress",e.Error="error",e.Success="success"}(L||(L={})),function(e){e.Text="text",e.File="file",e.Image="image",e.Widget="widget",e.System="system",e.Payment="payment",e.Sticker="sticker",e.Audio="audio"}(D||(D={})),function(e){e.Client="client",e.Manager="manager",e.Bot="bot",e.Guest="guest"}(W||(W={})),function(e){e.Online="online",e.Offline="offline",e.Away="away"}(z||(z={})),function(e){e.Tap="tap",e.MessageReceived="message_received"}(F||(F={})),function(e){e.DeepLink="deep_link",e.LongList="longlist",e.Response="response"}(j||(j={})),function(e){e.PrimaryTinkoff="primaryTinkoff",e.Secondary="secondary",e.Destructive="destructive",e.Flat="flat",e.PrimaryOpposite="primaryOpposite",e.PrimaryAccent="primaryAccent",e.PrimaryOnLight="primaryOnLight",e.PrimaryOnDark="primaryOnDark",e.GlassOnDark="glassOnDark",e.GlassOnLight="glassOnLight"}(B||(B={})),function(e){e.Square="square",e.Rectangular="rectangular"}(Z||(Z={})),function(e){e.ImgZone="img_zone",e.InfoZone="info_zone",e.TagZone="tag_zone"}(R||(R={})),function(e){e.Gradient="gradient",e.DarkBlueGradient="dark_blue_grd"}(V||(V={})),function(e){e.Title="title",e.Subtitle="subtitle",e.SearchLine="searchline",e.Image="image",e.Tag="tag",e.TagNumber="tagnumber",e.TagSubtitle="tagsubtitle",e.Card="card",e.CardHeader="card_header",e.Account="account",e.Offer="offer",e.Button="button",e.Widget="widget",e.State="state",e.Rating="rating",e.Price="price",e.Address="address",e.Subway="subway",e.Text="text"}(H||(H={})),function(e){e.Unknown="UNKNOWN",e.Economy="ECONOMY",e.Medium="MEDIUM",e.Premium="PREMIUM",e.Luxury="LUXURY"}(G||(G={})),function(e){e.GreenCheckmark="green_checkmark",e.BlackClock="black_clock"}(Q||(Q={})),function(e){e.VertList="vert_list",e.HorList="hor_list",e.Approval="approval",e.Link="link",e.CardImage="card_image",e.Post="post",e.LongList="long_list"}(K||(K={})),function(e){e.LeftDown="left-down",e.LeftUp="left-up",e.RightUp="right-up",e.RightDown="right-down",e.Center="center"}(Y||(Y={})),function(e){e.Center="center",e.Left="left",e.Right="right"}($||($={})),function(e){e.HeaderZone="header_zone",e.Cards="cards",e.InfoZone="info_zone",e.HighlightZone="highlight_zone",e.LegalZone="legal_zone",e.ButtonZone="button_zone",e.WidgetZone="widget_zone",e.HeaderImageZone="header_image_zone",e.StateZone="state_zone",e.GeoZone="geo_zone",e.MainZone="main_zone"}(J||(J={})),function(e){e.NoUpdate="no_update",e.Before="before",e.After="after"}(X||(X={}));const q="active_tab";const ee="isTmsgGuestZone";const se=new class EventEmitter{constructor(){this.listeners={}}on(e,s){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(s),this}off(e,s){var t;const n=null===(t=this.listeners[e])||void 0===t?void 0:t.indexOf(s);return n>-1&&this.listeners[e].splice(n,1),this}emit(e,...s){var t;null===(t=this.listeners[e])||void 0===t||t.forEach((e=>{e(...s)}))}},te=new class MessengerService{constructor(){this.isMessengerInited=!1,this.isMessengerOpened=!1,this.isMessengersListOpened=!1,this.isUnreadMessages=!1,this.shouldDisplayWelcomeForm=!1,this.currentWelcomeFormScreen=l.First}get iframeUrl(){return this.iframeUrlValue}set iframeUrl(e){this.iframeUrlOrigin=new URL(e).origin,this.iframeUrlValue=e}getTmsgHostUrl(e){return e.replace(/(business|webim)/g,"tmsg").replace(/\/messenger\/(sme|platform)\/?/g,"").split("?")[0]}getAppId(e,s="business"){return Object.keys(w).find((s=>-1!==w[s].indexOf(e)))||s}},ne=new class MobileService{constructor(e){this.eventEmitter=e,this.shouldCheckMobileMode=!1,this.isMobileMode=!1}checkMobileMode(){this.isMobileMode=!1,this.shouldCheckMobileMode&&(this.checkIfMobileMode(),window.addEventListener("resize",(()=>{this.checkIfMobileMode()})))}checkIfMobileMode(){const e=window.innerWidth<768;e!==this.isMobileMode&&(this.isMobileMode=e,this.eventEmitter.emit(a.Resize,this.isMobileMode))}}(se),ie=new class DomService{constructor(e,s,t){this.eventEmitter=e,this.messengerService=s,this.mobileService=t,this.closeMessengerOnStart=!0,this.unreadMessagesCounter=0,this.initIframe()}appendIframe(e){this.iframe.src=this.messengerService.iframeUrl,this.iframe.onload=()=>{this.messengerButton&&this.closeMessengerOnStart&&this.setMessengerClosedStyles(),this.eventEmitter.emit(o.IframeLoad),setTimeout((()=>{this.messengerService.isMessengerInited||(this.eventEmitter.emit(n.OnMessengerFail),this.hideMessengerPreloader())}),3e3)},e.appendChild(this.iframe)}listenUnreadIndicatorChanges(){this.eventEmitter.on(n.OnUnreadIndicatorChanged,(e=>{this.unreadIndicator.className=e&&!this.messengerService.isMessengerOpened?S.Visible:S.Hidden}))}listenUnreadMessagesCountChange(){this.eventEmitter.on(n.OnUnreadMessagesCountChanged,(e=>{var s;this.unreadMessagesCounter=e,this.unreadMessagesCount&&(this.unreadMessagesCount.innerText=(s=e,s?s>=1e3?`${Math.floor(s/1e3)}K`:`${s}`:"").toString())}))}addWidgetStylesAndElements(e,s){this.addWidgetStyles(!0,s),this.addMessengerButtonAndContainer(e),this.listenMessengerButtonEvents()}addMessengersList(s,t){this.addMessengersListStyles(),this.messengersListContainer=document.createElement("div"),this.messengersListContainer.className=b.Closed;this.getMessengersListItems(t).forEach((e=>{this.messengersListContainer.appendChild(this.getMessengersListElement(e))}));const n=this.getChatElement();n.addEventListener("click",(s=>{s.stopPropagation(),this.messengersListContainer.className=b.Closed,this.eventEmitter.emit(e.OpenMessenger)})),this.messengersListContainer.appendChild(n),s.appendChild(this.messengersListContainer)}hideMessengerPreloader(){this.messengerPreloader&&(this.messengerPreloader.className=M.Hidden)}addWidgetStyles(e=!0,s){const t=document.createElement("style"),n=e?function(e){const s=Object.assign(Object.assign({},C),e),{backgroundColor:t,backgroundHoverColor:n,backgroundActiveColor:i,iconOpen:r,iconClose:o}=s;return`\n        :root {\n            --mess-font-text: tuiText, -apple-system, 'BlinkMacSystemFont', system-ui, 'Roboto', 'Segoe UI', 'Helvetica Neue', sans-serif;\n            --mess-font-text-s: normal 0.8125rem/1.25rem var(--mess-font-text);\n        }\n         \n        html {\n            font-size: 16px;\n        }\n         \n        .messenger-button {\n            width: 60px;\n            height: 60px;\n            position:fixed;\n            bottom: 18px;\n            right:18px;\n            z-index: 1000;\n        }\n        \n        .messenger-button__inner-wrapper {\n            width: 60px;\n            height: 60px;\n            position: relative\n        }\n        \n        .messenger-button__inner-wrapper:hover .messenger-button__icon {\n            background-color:${n}\n        }\n\n        .messenger-button__inner-wrapper:active .messenger-button__icon {\n            background-color:${i}\n        }\n        \n        .messenger-button__icon {\n            width: 60px;\n            height: 60px;\n            background-color: ${t};\n            background-repeat: no-repeat;\n            background-position: 50% 50%;\n            position: absolute;\n            left: 0;\n            right: 0;\n            top: 0;\n            bottom: 0;\n            border-radius: 40px;\n            box-shadow: 0 10px 25px 0 rgba(0,0,0,.1);\n            cursor: pointer;\n            will-change:transform;\n            -webkit-transition: all .2s cubic-bezier(.25,0,.25,1);\n            -o-transition: all .2s cubic-bezier(.25,0,.25,1);\n            transition: all .2s cubic-bezier(.25,0,.25,1);\n            transition-property: transform,opacity,background-color,-webkit-transform;\n            -webkit-transform: translate3d(0,0,0);\n            transform:translate3d(0,0,0)\n        }\n        \n        .messenger-button__icon-chat {\n            background-image: url(${r})\n        }\n        \n        .messenger-button__icon-close {\n            background-image: url(${o})\n        }\n        \n        .messenger-opened .messenger-button__icon-close {\n            -webkit-transform:rotate(90deg);\n            -ms-transform:rotate(90deg);\n            transform: rotate(90deg);\n            opacity: 1;\n        }\n        \n        .messenger-closed .messenger-button__icon-close {\n            opacity: 0;\n        }\n        \n        .messenger-opened .messenger-button__icon-chat {\n            -webkit-transform: scale(.3);\n            -ms-transform: scale(.3);\n            transform: scale(.3);\n            opacity: 0;\n        }\n        \n        .messenger-closed .messenger-button__icon-chat {\n            opacity: 1;\n        }\n        \n        .messenger-button-hidden {\n            display: none\n        }\n        \n        .unread-indicator {\n            box-sizing: border-box;\n            position: absolute;\n            right: -4px;\n            top: -2px;\n            background-color: ${s.unreadIndicatorColor||C.unreadIndicatorColor};\n            min-width: 24px;\n            height: 24px;\n            padding: 0 0.25rem;\n            border-radius: 50%;\n            text-align: center;\n            color: #fff;\n            font: var(--mess-font-text-s);\n            user-select: none;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .unread-indicator-hidden {\n            display: none;\n        }`}(s):"",i=n+`\n        ${this.mobileService.shouldCheckMobileMode?"\n            .messenger-frame {\n                position: fixed;\n                top: 0;\n                right: 0;\n                bottom: 0;\n                left: 0;\n                z-index: 2001;\n            }\n            @media (min-width: 768px) {\n                .messenger-frame {\n                    position: fixed;\n                    width: 400px;\n                    height: 600px;\n                    max-height: calc(100vh - 212px);\n                    min-height: 360px;\n                    bottom: 92px;\n                    right: 18px;\n                    top: initial;\n                    left: initial;\n                }\n            }":"\n            .messenger-frame {\n                position: fixed;\n                width: 400px;\n                height: 600px;\n                max-height: calc(100vh - 212px);\n                min-height: 360px;\n                bottom: 92px;\n                right: 18px;\n                top: initial;\n                left: initial;\n            }\n        "}\n        \n        .messenger-frame-closed {\n            visibility: hidden; height: 0\n        }\n        .messenger-frame-opened {\n            visibility: visible;\n            opacity: 1;\n        }\n    .messenger-preloader {\n        box-sizing: border-box;\n        z-index:3000;\n        height: 56px;\n        width: 56px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        color: #ffdd2d;\n        position: absolute;\n        display: inline-block;\n        border: 4px solid;\n        border-radius: 50%;\n        border-top-color: transparent;\n        -webkit-animation: tmsg-rotate 1s linear infinite;\n        animation: tmsg-rotate 1s linear infinite\n    }\n    \n    .messenger-preloader-hidden {\n        display: none;\n    }\n    \n    @-webkit-keyframes tmsg-rotate {\n        0% {\n            -webkit-transform: translate(-50%, -50%) rotate(0);\n            transform: translate(-50%, -50%) rotate(0);\n        }\n        100% {\n            -webkit-transform: translate(-50%, -50%) rotate(360deg);\n            transform: translate(-50%, -50%) rotate(360deg);}\n    }\n    @keyframes tmsg-rotate {\n        0% {\n            -webkit-transform: translate(-50%, -50%) rotate(0);\n            transform: translate(-50%, -50%) rotate(0);\n        }\n        100% {\n            -webkit-transform: translate(-50%, -50%) rotate(360deg);\n            transform: translate(-50%, -50%) rotate(360deg);\n        }\n    }`;t.appendChild(document.createTextNode(i)),document.head.appendChild(t)}addWelcomeFormStyles(){const e=document.createElement("style"),s=this.mobileService.shouldCheckMobileMode?`@media (min-width: 768px) {${I}}`:I;e.appendChild(document.createTextNode(s)),document.head.appendChild(e)}setMessengerOpenedStyles(){this.messengerContainer.className=v.Opened,this.messengerButton.className=u.Opened,this.unreadIndicator.className=S.Hidden,this.messengerService.shouldDisplayWelcomeForm&&this.addWelcomeFormClasses(),this.messengerService.isMessengerInited||(this.messengerPreloader.className=M.Visible)}setMessengerClosedStyles(){this.messengerContainer.className=v.Closed,this.messengerButton.className=u.Closed,this.unreadIndicator.className=S.Hidden,this.messengerPreloader.className=M.Hidden,this.messengerService.isUnreadMessages&&(this.unreadIndicator.className=S.Visible)}onMessengerOpen(){this.messengerButton&&this.setMessengerOpenedStyles()}onMessengerClose(){this.messengerButton&&this.setMessengerClosedStyles()}onMessengersListOpen(){this.messengersListContainer&&(this.messengerService.isMessengersListOpened=!0,this.messengerButton.className=u.Opened,this.messengersListContainer.className=b.Opened)}onMessengersListClose(){this.messengersListContainer&&(this.messengerService.isMessengersListOpened=!1,this.messengersListContainer.className=b.Closed)}updateWelcomeFormScreen(e){this.removeWelcomeFormClasses(),this.messengerService.shouldDisplayWelcomeForm=!!e,this.messengerService.currentWelcomeFormScreen=e,this.messengerService.shouldDisplayWelcomeForm&&this.addWelcomeFormClasses()}initIframe(){this.iframe=document.createElement("iframe"),this.iframe.style.cssText="\n    height: 100%;\n    width: 100%;\n    box-shadow: 4px 0px 24px rgba(0, 0, 0, 0.12);\n    border-radius: 12px;\n    background: #fff;\n",this.iframe.setAttribute("frameBorder","0"),this.iframe.setAttribute("allow","clipboard-read; clipboard-write")}addMessengerButtonAndContainer(e){this.messengerButton=document.createElement("div"),this.messengerButton.innerHTML='\n    <div class="messenger-button__inner-wrapper">\n        <div class="messenger-button__icon messenger-button__icon-chat"></div>\n        <div class="messenger-button__icon messenger-button__icon-close"></div>\n    </div>',this.unreadIndicator=document.createElement("div"),this.unreadMessagesCount=document.createElement("div"),this.messengerContainer=document.createElement("div"),this.messengerPreloader=document.createElement("div"),this.messengerButton.className=u.Hidden,this.messengerContainer.className=v.Closed,this.messengerPreloader.className=M.Hidden,this.messengerButton.appendChild(this.unreadIndicator),this.unreadIndicator.appendChild(this.unreadMessagesCount),e.appendChild(this.messengerButton),e.appendChild(this.messengerContainer),this.messengerContainer.appendChild(this.messengerPreloader),this.messengerService.appContainer=this.messengerContainer,this.messengerContainer.appendChild(this.iframe)}listenMessengerButtonEvents(){this.messengerButton.addEventListener("click",(s=>{s.stopPropagation(),this.eventEmitter.emit(e.ToggleMessenger)}))}getMessengersListElement({icon:e,href:s,name:t}){const n=document.createElement("a");return n.innerHTML=`<a class="tmsg-messengers-list__item" href="${s}" target="_blank" rel="noopener">\n            <div class="tmsg-messengers-list__icon" style="background-image: url('${e}')"></div>\n            <span>${t}</span>\n        </a>`,n}getChatElement(){const e=document.createElement("div");return e.innerHTML='<div class="tmsg-messengers-list__item">\n            <div class="tmsg-messengers-list__icon" style="background-image: url(\'https://business.cdn-tinkoff.ru/static/projects/messenger/icons/messengers/tmsg.svg\')"></div>\n            <span>\u0427\u0430\u0442</span>\n        </div>',e}addMessengersListStyles(){const e=document.createElement("style");e.appendChild(document.createTextNode("\n    .tmsg-messengers-list-container {\n        position: fixed;\n        display: flex;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n        max-width: 360px;\n        bottom: 92px;\n        right: 12px;\n        z-index: 1001;\n    }\n    .tmsg-messengers-list-container_closed {\n        display: none;\n    }\n    .tmsg-messengers-list__item {\n        display: flex;\n        align-items: center;\n        width: max-content;\n        margin: 6px;\n        padding: 4px;\n        border-radius: 14px;\n        color: #000;\n        text-decoration: none;\n        background: #eaecee;\n        cursor: pointer;\n    }\n    .tmsg-messengers-list__item:hover {\n        background: #c7c9cc;\n    }\n    .tmsg-messengers-list__item span {\n        padding: 8px 12px;\n    }\n    .tmsg-messengers-list__icon {\n        width: 36px;\n        height: 36px;\n        border-radius: 14px;\n        background-color: #fff;\n        background-repeat: no-repeat;\n        background-position: 50% 50%;\n    }")),document.head.appendChild(e)}addWelcomeFormClasses(){const e=this.getCurrentWelcomeFormClasses();this.messengerContainer.classList.add(...e.split(" "))}removeWelcomeFormClasses(){const e=this.getCurrentWelcomeFormClasses();this.messengerContainer.classList.remove(...e.split(" "))}getCurrentWelcomeFormClasses(){switch(this.messengerService.currentWelcomeFormScreen){case l.First:return f.FirstScreen;case l.Second:{const e=Object.keys(this.messengerService.welcomeFormConfig.secondScreen.controls).length;return`${f.SecondScreen} welcome-form_${e}-control`}default:return""}}getMessengersListItems(e){const s=[];return Object.keys(h).forEach((t=>{e[t]&&s.push({name:p[t],href:e[t],icon:h[t]})})),s}}(se,te,ne),re=new class NotificationService{constructor(e){this.messengerService=e,this.canCreateNotifications=!0}get notificationsAvailable(){return!!window.Notification&&this.canCreateNotifications}get hasPermission(){return this.notificationsAvailable&&"granted"===window.Notification.permission}recalculateActiveTab(){document.hasFocus()?setTimeout((()=>{localStorage.setItem(q,"true")})):localStorage.removeItem(q)}initialize(){this.notificationsAvailable&&(this.recalculateActiveTab(),this.askForNotifications(),window.addEventListener("beforeunload",(()=>{this.recalculateActiveTab()})),window.addEventListener("focus",(()=>{this.recalculateActiveTab()})),window.addEventListener("blur",(()=>{this.recalculateActiveTab()})))}notify(e,s,t,n){if(localStorage.getItem(q)||!this.notificationsAvailable)return;let i;try{i=new window.Notification(e,{body:s,tag:t,data:n,icon:U})}catch(r){return void(this.canCreateNotifications=!1)}i.onclick=function(){window.focus(),window["t-messenger"].api.openMessenger(),(null==n?void 0:n.conversationId)&&window["t-messenger"].api.openConversationById(n.conversationId),this.close()}}askForNotifications(){const e=!1!==this.messengerService.tmsgInitData.requestNotificationPermission;this.notificationsAvailable&&!this.hasPermission&&e&&window.Notification.requestPermission()}}(te),oe=new class AppPostMessageService{constructor(e,s,t,n){this.eventEmitter=e,this.messengerService=s,this.domService=t,this.notificationService=n,this.postMessagesQueue=[]}listenMessages(){window.addEventListener("message",(s=>{const t=!s.origin||s.origin===this.messengerService.iframeUrlOrigin;if(!s.data||!t)return;const{messageCode:i,data:r}=s.data;switch(i){case c.UpdateUnreadCounter:this.eventEmitter.emit(n.OnUnreadIndicatorChanged,!!r),this.messengerService.isUnreadMessages=!!r;break;case c.UpdateUnreadMessagesCount:this.eventEmitter.emit(n.OnUnreadMessagesCountChanged,r);break;case c.TmsgInit:this.messengerService.isMessengerInited=!0,this.sendQueuedMessages(),this.sendDataToApplication(),this.domService.hideMessengerPreloader(),this.eventEmitter.emit(n.OnMessengerInited);break;case c.TmsgClose:this.eventEmitter.emit(e.CloseMessenger);break;case c.FocusEvent:this.notificationService.recalculateActiveTab();break;case c.PushNotification:{const{authorName:e,messageId:s,conversationId:t,content:n}=r;this.notificationService.notify(e,n,s,{conversationId:t});break}case c.TmsgUpdateSession:this.eventEmitter.emit(n.OnMessengerUpdateSession);break;case c.TmsgUrlRequest:this.sendPostMessageWithoutQueue(c.TmsgUrlResponse,this.messengerService.iframeUrl);break;case c.TmsgWelcomeFormDisplayStatus:this.messengerService.shouldDisplayWelcomeForm=r,this.messengerService.isMessengerOpened&&this.messengerService.shouldDisplayWelcomeForm&&this.domService.updateWelcomeFormScreen(this.messengerService.currentWelcomeFormScreen);break;case c.TmsgWelcomeFormScreenChanged:this.domService.updateWelcomeFormScreen(r);break;case c.TmsgPlatformUserRequest:this.sendPostMessageWithoutQueue(c.TmsgPlatformUserResponse,this.messengerService.authUserPayload);break;case c.TmsgScreenChanged:this.eventEmitter.emit(n.OnMessengerScreenChanged,r)}}))}sendQueuedMessages(){this.postMessagesQueue.length&&this.messengerService.isMessengerInited&&(this.postMessagesQueue.forEach((({messageCode:e,data:s})=>{this.sendPostMessage(e,s)})),this.postMessagesQueue=[])}sendPostMessageWithoutQueue(e,s){this.domService.iframe.contentWindow&&this.domService.iframe.contentWindow.postMessage({messageCode:e,data:s},this.messengerService.iframeUrlOrigin)}sendPostMessage(e,s){this.messengerService.isMessengerInited?this.sendPostMessageWithoutQueue(e,s):this.postMessagesQueue.push({messageCode:e,data:s})}sendDataToApplication(){const{title:e,subtitle:s,avatarUrl:t,colorConfig:n,welcomeFormConfig:i,closeButtonVisibility:r}=this.messengerService.widgetOptions;this.messengerService.tmsgInitData&&this.sendPostMessage(c.TmsgUserInfo,Object.assign({},this.messengerService.tmsgInitData)),e&&this.sendPostMessage(c.TmsgWidgetTitle,e),s&&this.sendPostMessage(c.TmsgWidgetSubtitle,s),t&&this.sendPostMessage(c.TmsgWidgetAvatar,t),n&&this.sendPostMessage(c.TmsgColorConfig,n),i&&this.sendPostMessage(c.TmsgWelcomeFormConfig,i),r&&this.sendPostMessage(c.TmsgCloseButtonVisibility,r)}}(se,te,ie,re),ae=new class LazyMessengerInitService{constructor(e){this.domService=e,this.timer=null,this.isInitFnInvoked=!1,this.initFn=()=>{}}initMessenger(e,s){this.initFn=e;const t=null==s?void 0:s.startOnClick,n=null==s?void 0:s.startDelay;if(!t)return n?(this.showMessengerButton(),void(this.timer=setTimeout((()=>{this.invokeInitFn()}),n))):void this.invokeInitFn();this.showMessengerButton()}onMessengerOpen(){this.domService.messengerButton&&!this.isInitFnInvoked&&(clearTimeout(this.timer),this.invokeInitFn())}invokeInitFn(){this.initFn(),this.isInitFnInvoked=!0}showMessengerButton(){this.domService.closeMessengerOnStart=!1,this.domService.setMessengerClosedStyles()}}(ie),ce=new class WebimAuthService{constructor(e,s,t){this.eventEmitter=e,this.messengerService=s,this.domService=t}loadMessenger(e,{location:s,autofocus:t,requestNotificationPermission:n,data:i,closeButtonVisibility:r,platformType:o}){this.messengerService.tmsgInitData=Object.assign(Object.assign({},this.messengerService.tmsgInitData),{location:s,autofocus:t,requestNotificationPermission:n,chatStartInfo:Object.assign(Object.assign({},i),{referer:document.location.href}),platformType:o}),this.messengerService.widgetOptions=Object.assign(Object.assign({},this.messengerService.widgetOptions),{closeButtonVisibility:r}),this.messengerService.iframeUrl=e,this.domService.addWidgetStyles(!1),this.addPreloader(),this.loadTmsg()}listenForGuestZoneSwitching(){window.addEventListener("storage",(e=>{const{storageArea:s,key:t,newValue:n}=e;s===localStorage&&t===ee&&"true"===n&&(this.messengerService.platformInfo=Object.assign(Object.assign({},this.messengerService.platformInfo),{user:null}),this.loadMessenger(this.messengerService.iframeUrl,this.messengerService.platformInfo))}))}checkForGuestZone(){if(!this.messengerService.authUserPayload)try{localStorage.setItem(ee,"true"),localStorage.removeItem(ee)}catch(e){}}loadTmsg(){const s=this.messengerService.getAppId(this.messengerService.tmsgInitData.location,this.messengerService.tmsgInitData.appId||"bank"),t=this.messengerService.getTmsgHostUrl(this.messengerService.iframeUrl),n=Object.assign(Object.assign({},this.messengerService.tmsgInitData),{appId:s});this.domService.iframe.style.display="block",this.eventEmitter.emit(e.InitTmsg,this.messengerService.appContainer,t,n,this.messengerService.widgetOptions)}addPreloader(){this.domService.messengerPreloader||(this.domService.messengerPreloader=document.createElement("div"),this.messengerService.appContainer.appendChild(this.domService.messengerPreloader)),this.domService.messengerPreloader.className=M.Visible}}(se,te,ie);const ge=new class WidgetApi{constructor(s,t,n,i,r,g,m,d){this.eventEmitter=s,this.messengerService=t,this.mobileService=n,this.domService=i,this.notificationService=r,this.appPostMessageService=g,this.lazyMessengerInitService=m,this.webimAuthService=d,this.eventEmitter.on(e.InitTmsg,this.initTmsg.bind(this)),this.eventEmitter.on(e.OpenMessenger,this.openMessenger.bind(this)),this.eventEmitter.on(e.CloseMessenger,this.closeMessenger.bind(this)),this.eventEmitter.on(e.ToggleMessenger,this.toggleMessenger.bind(this)),this.eventEmitter.on(a.Resize,(e=>{this.appPostMessageService.sendPostMessage(c.PlatformResize,e)})),this.eventEmitter.on(o.IframeLoad,(()=>{setTimeout((()=>{this.appPostMessageService.sendPostMessage(c.TmsgButtonInited,this.domService.unreadMessagesCounter)}),2e3)}))}initSmeButton(e){this.mobileService.shouldCheckMobileMode=!0,this.domService.addWidgetStylesAndElements(e),this.domService.closeMessengerOnStart=!1,this.domService.setMessengerClosedStyles()}initSmeFrame(e,s,t={}){this.initSme(this.messengerService.appContainer,e,s,t),this.domService.listenUnreadIndicatorChanges(),this.domService.listenUnreadMessagesCountChange()}initSmeWithButton(e,s,t,n={}){this.initSmeButton(e),this.initSmeFrame(s,t,n)}initSme(e,s,t,{closeButtonVisibility:n}={}){this.domService.messengerContainer||(this.messengerService.appContainer=e);const i=this.messengerService.getAppId(t.location,"business"),o=Object.assign(Object.assign({},t),{appId:i});this.initTmsg(this.messengerService.appContainer,s,o,{closeButtonVisibility:n||r.Hidden})}initTmsg(e,s,t,n={}){this.messengerService.tmsgInitData=Object.assign(Object.assign({},t),{parentUrlPath:window.location.href.split("?")[0]}),this.messengerService.widgetOptions=n;const i=t.appId||this.messengerService.getAppId(this.messengerService.tmsgInitData.location,"default"),r=this.messengerService.tmsgInitData.authSystem?`${s}?app=${i}&auth=${this.messengerService.tmsgInitData.authSystem}`:`${s}?app=${i}`;this.messengerService.iframeUrl=r,this.appPostMessageService.listenMessages(),this.notificationService.initialize(),this.domService.appendIframe(e),this.mobileService.checkMobileMode()}initTmsgWithButton(e,s,n,i={}){const{messengers:r,widgetButtonConfig:o,welcomeFormConfig:a}=i;this.mobileService.shouldCheckMobileMode=!0,this.domService.addWidgetStylesAndElements(e,o),r&&this.domService.addMessengersList(e,r),a&&(this.messengerService.welcomeFormConfig=a,this.domService.addWelcomeFormStyles()),this.domService.listenUnreadIndicatorChanges(),this.domService.listenUnreadMessagesCountChange();(null==n?void 0:n.authSystem)===t.Webim&&(this.messengerService.authUserPayload=n.user);const c=this.initTmsg.bind(this,this.messengerService.appContainer,s,n,i);this.lazyMessengerInitService.initMessenger(c,n.messengerStartConfig)}initPlatform(e,s,t,n=!0){this.messengerService.appContainer=e,this.messengerService.platformInfo=t,this.messengerService.authUserPayload=t.user,this.messengerService.initialPlatformUrl=s,this.mobileService.shouldCheckMobileMode=n,this.mobileService.checkMobileMode(),this.webimAuthService.listenForGuestZoneSwitching(),this.webimAuthService.loadMessenger(s,t),this.domService.listenUnreadMessagesCountChange()}onMessengerUpdateSession(e){this.eventEmitter.on(n.OnMessengerUpdateSession,e)}openMessenger(){this.messengerService.isMessengerOpened=!0,this.domService.closeMessengerOnStart=!1,this.domService.onMessengerOpen(),this.lazyMessengerInitService.onMessengerOpen(),this.domService.onMessengersListClose(),this.eventEmitter.emit(n.OnMessengerOpen),this.appPostMessageService.sendPostMessage(c.MessengerOpenedStatus,{isMessengerOpened:this.messengerService.isMessengerOpened,counter:this.domService.unreadMessagesCounter})}closeMessenger(){this.messengerService.isMessengerOpened=!1,this.domService.onMessengerClose(),this.domService.onMessengersListClose(),this.eventEmitter.emit(n.OnMessengerClose),this.appPostMessageService.sendPostMessage(c.MessengerOpenedStatus,{isMessengerOpened:this.messengerService.isMessengerOpened})}toggleMessenger(){this.messengerService.isMessengerOpened||this.messengerService.isMessengersListOpened?this.closeMessenger():!this.domService.messengersListContainer||this.messengerService.isUnreadMessages?this.openMessenger():this.domService.onMessengersListOpen()}setAppLocation(e){this.appPostMessageService.sendPostMessage(c.UpdateLocation,e)}onUnreadIndicatorChanged(e){this.eventEmitter.on(n.OnUnreadIndicatorChanged,e)}onUnreadMessagesCountChange(e){this.eventEmitter.on(n.OnUnreadMessagesCountChanged,e)}onMessengerOpen(e){this.eventEmitter.on(n.OnMessengerOpen,e)}onMessengerClose(e){this.eventEmitter.on(n.OnMessengerClose,e)}onMessengerInited(e){this.eventEmitter.on(n.OnMessengerInited,e)}onMessengerFail(e){this.eventEmitter.on(n.OnMessengerFail,e)}onMessengerScreenChanged(e){this.eventEmitter.on(n.OnMessengerScreenChanged,e)}updateUser({user:e,location:s},n){if(this.messengerService.isMessengerInited)switch(this.messengerService.authUserPayload=e,n){case t.Sso:return this.messengerService.tmsgInitData.location=s||this.messengerService.tmsgInitData.location,void this.initTmsg(this.messengerService.appContainer,this.messengerService.iframeUrl,this.messengerService.tmsgInitData,this.messengerService.widgetOptions);case t.Webim:return this.messengerService.platformInfo=Object.assign(Object.assign({},this.messengerService.platformInfo),{user:e,location:s}),this.webimAuthService.checkForGuestZone(),void this.webimAuthService.loadMessenger(this.messengerService.iframeUrl.split("?")[0],this.messengerService.platformInfo);default:{const e=Object.values(t).map((e=>`"${e}"`)).join(" or ");throw new Error(`Widget API: Unknown authSystem were passed to updateUser method, expected ${e}, but got "${n}"`)}}}updateCompanyId(e){this.appPostMessageService.sendPostMessage(c.UpdateCompanyId,e)}updateApplications(e){this.appPostMessageService.sendPostMessage(c.UpdateApplications,e)}updateLocale(e){this.appPostMessageService.sendPostMessage(c.UpdateLocale,e)}updateCloseButtonVisibility(e){this.appPostMessageService.sendPostMessage(c.TmsgCloseButtonVisibility,e)}openConversationById(e){this.appPostMessageService.sendPostMessage(c.OpenConversationById,e)}openConversationByAppId(){this.openSupportConversation()}openSupportConversation(){this.appPostMessageService.sendPostMessage(c.OpenSupportConversation)}openConversationWithDraftMessage(e){this.appPostMessageService.sendPostMessage(c.TmsgOpenDraft,{messageDraft:e})}sendMessage({message:e}){this.appPostMessageService.sendPostMessage(c.TmsgSendMessage,{message:e})}}(se,te,ne,ie,re,oe,ae,ce);window["t-messenger"]={api:ge}})();